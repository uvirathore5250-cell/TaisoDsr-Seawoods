<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TAISO DSR - CRM STYLE</title>
    <style>
        :root { --neon: #92d050; --bg: #000; --card: #111; --gold: #d4af37; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; padding: 0; margin: 0; padding-bottom: 85px; }
        
        /* Header */
        .header { position: fixed; top: 0; left: 0; width: 100%; background: #1a1a1a; padding: 15px 0; text-align: center; border-bottom: 2px solid var(--neon); z-index: 1000; }
        
        /* Bottom Nav */
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #1a1a1a; display: flex; border-top: 1px solid #333; z-index: 1000; }
        .nav-item { flex: 1; padding: 15px; text-align: center; color: #666; font-weight: bold; cursor: pointer; }
        .nav-item.active { color: var(--neon); border-top: 3px solid var(--neon); background: #222; }

        .content-page { display: none; padding: 85px 15px 20px 15px; }
        .content-page.active { display: block; }

        /* CRM Style Cards */
        .dsr-card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 12px; border: 1px solid #222; border-left: 5px solid var(--neon); }
        .history-box { font-size: 11px; background: #000; padding: 10px; border-radius: 8px; margin: 10px 0; color: #ccc; border: 1px dashed #444; white-space: pre-line; }
        
        /* Form Elements */
        input, textarea, .save-btn { width: 100%; padding: 14px; margin: 8px 0; background: #050505; border: 1px solid #333; color: #fff; border-radius: 10px; box-sizing: border-box; }
        .save-btn { background: var(--neon); color: #000; font-weight: bold; border: none; cursor: pointer; font-size: 16px; margin-top: 10px; }
        
        .label-tag { font-size: 10px; color: var(--neon); text-transform: uppercase; margin-left: 5px; font-weight: bold; }
        .row { display: flex; gap: 10px; }
        .row div { flex: 1; }
    </style>
</head>
<body>

    <div class="header"><b>TAISO DSR SYSTEM</b></div>

    <div id="page-add" class="content-page active">
        <div style="background:var(--card); padding:20px; border-radius:20px; border: 1px solid #222;">
            <h3 style="color:var(--neon); margin-top:0;">Daily Sales Entry</h3>
            
            <label class="label-tag">Report Date</label>
            <input type="date" id="rDate">

            <div class="row">
                <div><label class="label-tag">Gym Cash</label><input type="number" id="gCash" value="0"></div>
                <div><label class="label-tag">Gym UPI</label><input type="number" id="gUpi" value="0"></div>
            </div>

            <div class="row">
                <div><label class="label-tag">PT Cash</label><input type="number" id="pCash" value="0"></div>
                <div><label class="label-tag">PT UPI</label><input type="number" id="pUpi" value="0"></div>
            </div>

            <label class="label-tag">Total Enquiries Today</label>
            <input type="number" id="enq" value="0">

            <label class="label-tag">Special Notes / Remarks</label>
            <textarea id="note" rows="3" placeholder="Enter today's summary..."></textarea>
            
            <button onclick="submitDSR()" id="mainBtn" class="save-btn">SAVE TO CLOUD</button>
        </div>
    </div>

    <div id="page-history" class="content-page">
        <div id="historyContainer"></div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="nav('add', this)">âž• ADD</div>
        <div class="nav-item" onclick="nav('history', this)">ðŸ“œ HISTORY</div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycby5RGdPRECI2ZJZLp_gY-hcV4XgVmT4sr3JxT9pB8V3PcUAH1qoP59jXI3H6m-vhld4ag/exec'; 
        let reports = [];

        // Set default date to today
        document.getElementById('rDate').valueAsDate = new Date();

        function nav(p, el) {
            document.querySelectorAll('.content-page').forEach(pg => pg.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(nv => nv.classList.remove('active'));
            document.getElementById('page-' + p).classList.add('active');
            el.classList.add('active');
            if(p === 'history') sync();
        }

        async function sync() {
            const cont = document.getElementById('historyContainer');
            cont.innerHTML = "<p style='text-align:center; color:#666;'>Loading History...</p>";
            try {
                const res = await fetch(scriptURL + '?t=' + Date.now());
                reports = await res.json();
                render();
            } catch(e) { cont.innerHTML = "Error loading data."; }
        }

        async function submitDSR() {
            const btn = document.getElementById('mainBtn');
            const originalText = btn.innerText;
            btn.innerText = "Syncing...";
            btn.disabled = true;

            const gCash = Number(document.getElementById('gCash').value);
            const gUpi = Number(document.getElementById('gUpi').value);
            const pCash = Number(document.getElementById('pCash').value);
            const pUpi = Number(document.getElementById('pUpi').value);
            const dateVal = document.getElementById('rDate').value;
            const note = document.getElementById('note').value;

            // Creating CRM style history log
            const historyLog = `[Report Date: ${dateVal}]\nTotal Gym: â‚¹${gCash + gUpi}\nTotal PT: â‚¹${pCash + pUpi}\nEnquiries: ${document.getElementById('enq').value}\nNotes: ${note}`;

            const payload = {
                date: dateVal,
                gymCash: gCash,
                gymUpi: gUpi,
                ptCash: pCash,
                ptUpi: pUpi,
                enq: document.getElementById('enq').value,
                history: historyLog
            };

            try {
                await fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
                alert("Report Saved Successfully!");
                location.reload();
            } catch (e) {
                alert("Failed to save.");
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        function render() {
            const cont = document.getElementById('historyContainer');
            cont.innerHTML = '';

            if(reports.length === 0) {
                cont.innerHTML = "<p style='text-align:center; color:#666;'>No reports found.</p>";
                return;
            }

            [...reports].reverse().forEach((r) => {
                const div = document.createElement('div');
                div.className = 'dsr-card';
                // Date formatting for header
                const displayDate = new Date(r.date).toLocaleDateString('en-IN', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
                
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <b style="color:var(--neon);">${displayDate}</b>
                        <span style="font-size:12px; background:#222; padding:2px 8px; border-radius:5px;">â‚¹${Number(r.gymCash||0)+Number(r.gymUpi||0)+Number(r.ptCash||0)+Number(r.ptUpi||0)}</span>
                    </div>
                    <div class="history-box">${r.history || 'No details recorded.'}</div>
                `;
                cont.appendChild(div);
            });
        }
        window.onload = sync;
    </script>
</body>
</html>
